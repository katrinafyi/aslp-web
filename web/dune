(library
  (name lib)
  (modules lib)
  (libraries (re_export asli.libASL) asli.libASL-web (re_export js_of_ocaml)))

(executable
  (name js)
  (modes js)
  (modules js)

  (libraries lib)
  (js_of_ocaml (flags --sourcemap :standard \ --source-map-inline))
  (preprocess (pps js_of_ocaml-ppx)))

(executable
  (name builder)
  (modes js)
  (modules builder)

  (libraries lib)
  (js_of_ocaml (flags --sourcemap :standard \ --source-map-inline))
  (preprocess (pps js_of_ocaml-ppx)))

(rule
 (target aslp.heap)
 (deps builder.bc.js pako.min.js cache.js)
 (action (run node ./cache.js)))

; javascript executable to build aslp.heap
(install
 (files builder.bc.js pako.min.js cache.js)
 (section bin))

; static files for distribution
(install
 (files js.bc.js index.html reset.css aslp.js cache.js aslp.heap pako.min.js)
 (section lib))
